---
layout: editorial
---

# Index Condition Pushdown(인덱스 조건 푸시다운)

인덱스 컨디션 푸시다운(ICP)은 MySQL 5.6부터 도입된 옵티마이저의 최적화 기능으로, 인덱스 스캔 효율을 극대화하는 기술이다.  
간단히 말해, 테이블의 실제 데이터까지 접근하기 전에 인덱스만으로 WHERE 절의 일부 조건을 필터링하는 기능으로, 이를 통해 스토리지 엔진과 서버 계층 간의 불필요한 데이터 전송량을 줄여 쿼리 성능을 향상시킨다.

## ICP의 원리

일반적으로 MySQL에서 쿼리를 실행할 때, WHERE 절의 조건을 평가하기 위해 스토리지 엔진은 다음과 같은 과정을 거친다.

1. 스토리지 엔진이 인덱스를 통해 레코드의 위치를 찾은 후 해당 레코드 전체를 읽어와 서버 계층으로 전달
2. 이후 서버 계층에서 WHERE 절의 나머지 조건들을 평가

ICP를 적용하면, 스토리지 엔진이 인덱스에 저장된 컬럼 정보만으로 WHERE 절의 조건을 자체적으로 평가하게 되면서 다음과 같은 이유로 성능이 향상된다.

- 자체적으로 WHERE 절의 조건을 평가하여, 해당 레코드의 실제 데이터를 읽지 않음 -> I/O 비용 절감
- 서버 계층으로 전달되는 데이터 양 감소 -> 데이터 전송 비용 절감

## 예시 쿼리

```sql
SELECT
    *
FROM
    employees
WHERE
    last_name = 'Ogu'
    AND first_name LIKE 'J%';
```

- `employees` 테이블: `(last_name, first_name)` 인덱스 존재

### ICP 비활성화 시 (기존 방식)

1. 엔진은 `(last_name, first_name)` 인덱스에서 `last_name = 'Ogu'`인 모든 인덱스 엔트리를 탐색
2. `last_name`이 'Ogu'인 모든 레코드의 PK 값을 읽음
3. 찾아낸 모든 PK 값을 이용해 실제 테이블의 데이터 레코드를 하나씩 서버 계층으로 전송
4. 서버 계층은 전달받은 레코드에 대해 `first_name LIKE 'J%'` 조건을 평가하고 최종 결과를 필터링

만약 'Ogu' 성을 가진 사람이 100만 명인데 'J'로 시작하는 이름이 100명이라면, 엔진은 100만 건의 데이터를 불필요하게 읽어와 서버로 전송하게 되면서 성능이 크게 저하된다.

### ICP 활성화 시 (ICP 방식)

1. 엔진은 `(last_name, first_name)` 인덱스에서 `last_name = 'Ogu'`인 모든 인덱스 엔트리를 탐색
2. 이때, 엔진은 `first_name` 인덱스 컬럼 정보도 함께 사용하여 `first_name LIKE 'J%'` 조건도 자체적으로 평가
3. 두 조건을 모두 만족하는(`last_name = 'Ogu'`와 `first_name LIKE 'J%'`) 인덱스 엔트리만 선택
4. 선택된 인덱스 엔트리의 PK 값만을 이용해 실제 테이블 데이터에 접근
5. 엔진은 두 조건을 모두 만족하는 **100개의 레코드만** 읽어와 서버로 전송

결과적으로, ICP를 사용하면 스토리지 엔진이 불필요한 데이터 I/O를 미리 차단하고, 서버로 전송하는 데이터 양을 획기적으로 줄여 쿼리 성능이 크게 개선된다.
