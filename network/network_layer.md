---
layout: editorial
---

# 네트워크 계층 (Network Layer) - TCP/IP Layer 2

> 물리 계층과 데이터 계층에 해당하는 Network Access Layer는 LAN에 국한된 통신을 담당하는 계층이다.  
> 네트워크 계층은 LAN을 넘어서기 위한 계층으로, 라우팅을 하여 네트워크 간 통신이 가능하도록 한다.

현재 사용되는 대표적인 프로토콜로 IP(Internet Protocol)가 있다.

## MAC 주소가 있지만 IP 주소도 필요한 이유

모든 네트워크 장비는 MAC 주소를 가지고 있기 때문에 임의의 네트워크에 속한 MAC 주소를 파악하여 통신하는 것은 불가능에 가깝다.  
때문에 IP 주소를 통해 네트워크를 식별하고, 식별한 네트워크에 속한 장비들의 MAC 주소를 파악하여 통신을 한다.

|         MAC 주소          |           IP 주소            |
|:-----------------------:|:--------------------------:|
| 네트워크 장비에 할당된 고유한 물리적 주소 | 네트워크에 연결된 컴퓨터를 식별하는 논리적 주소 |
| 네트워크 장비가 제조사에 의해 직접 할당  |        네트워크 관리자가 할당        |
|      일반적으로 변경 불가능       |           변경 가능            |
|      48비트(6바이트) 길이      |    일반적으로 32비트(4바이트) 길이     |

## IP의 주요 기능

### IP 주소 지정

IP 주소는 직접 지정할 수도 있지만, DHCP(Dynamic Host Configuration Protocol)를 통해 자동으로 할당받을 수도 있다.

### 단편화(Fragmentation)

패킷의 크기를 MTU(Maximum Transmission Unit)라고 하며, 일반적으로 1500byte(=약 1.4kb)이다.  
더 큰 데이터를 전송하기 위해서는 L3 패킷을 분할하여 전송하는 단편화(Fragmentation)를 수행하고, 목적지에서 다시 재조립하여 사용한다.

## IP 주소 종류

IPv4와 IPv6가 존재하며, IPv4는 32비트로 구성되어 있고, IPv6는 128비트로 구성되어 있다.  
현재는 둘 다 사용하지만 아직까지 IPv4가 주로 사용되고 있으며, IPv6는 IPv4의 주소 고갈 문제를 방지하기 위해 등장하였다.(실제론 다른 기술로 IPv4 주소 고갈 문제를 해결하고 있다.)

|       IPv4        |                  IPv6                   |
|:-----------------:|:---------------------------------------:|
|    4바이트(32비트)     |              16바이트(128비트)               |
| 0 ~ 255까지의 숫자로 표현 |                16진수로 표현                 |
| 8비트씩 4개의 옥텟으로 구성  |            16비트씩 8개의 옥텟으로 구성            |
|    192.168.1.1    | 2001:0db8:85a3:0000:0000:8a2e:0370:7334 |

### IPv4의 헤더

- 단편화에 사용되는 헤더 정보
    - 식별자: 단편화된 패킷을 재조립할 때 사용하는 식별값
    - 플래그: 단편화에 대한 정보를 담고 있는 비트열
    - 단편화 오프셋: 단편화되기 전 원본 데이터에서 해당 패킷이 위치한 오프셋
- 그 외
    - TTL(Time To Live): 패킷이 네트워크 장치(라우터)를 통과할 때마다 1씩 감소하는 카운터로, 0이 되면 해당 패킷은 폐기, 폐기 시 장치에서 ICMP 메시지 전송
    - 프로토콜: 상위 계층 프로토콜을 명시하는 필드(TCP: 6, UDP: 17... etc)
    - 헤더 체크섬
- 주소 정보
    - 송신지 IP 주소
    - 목적지 IP 주소

### IPv6의 헤더

- 페이로드 길이
- 다음 헤더(=확장 헤더): 고정되지 않은 헤더로, 필요한 경우 추가되는 헤더(ex. 단편화, 인증, 암호화 등)
- 홉 제한: TTL과 비슷한 역할
- 주소 정보
    - 송신지 IP 주소
    - 목적지 IP 주소


## 127.0.0.1(Localhost)

로컬호스트 IP로 루프백(Loopback) 네트워크 인터페이스로 사용하기 위해 예약해 놓은 IP로, 자신의 컴퓨터를 의미한다.  
해당 IP에 요청하기 되면 외부 네트워크로부터 격리되며 물리적인 네트워크 인터페이스를 통하지 않고, 컴퓨터 내부에서만 통신이 이루어진다.

![Loopback Network](image/loopback_network_ipc.png)

###### 참고자료

- [외워서 끝내는 네트워크 핵심이론 - 기초](https://www.inflearn.com/course/네트워크-핵심이론-기초)