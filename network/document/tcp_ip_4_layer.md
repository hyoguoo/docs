# TCP/IP 4 Layer

> 네트워크의 기본으로 인터넷을 포함하여 일반적으로 사용하고 있는 네트워크는 TCP/IP라는 프로토콜에서 움직이며 HTTP도 그 중 하나

## TCP/IP 4 계층

|        프로토콜 계층        |        예시        |                       설명                        |
|:---------------------:|:----------------:|:-----------------------------------------------:|
| 애플리케이션 계층 - HTTP, FTP | 웹 브라우저, 채팅 프로그램  |       유저에게 제공되는 애플리케이션에서 사용하는 통신의 움직임을 결정       |
|   전송 계층 - TCP, UDP    |   OS(TCP/UDP)    | 애플리케이션 계층에 네트워크로 접속되어 있는 2대의 컴퓨터 사이의 데이터 흐름을 제공 |
|      인터넷 계층 - IP      |      OS(IP)      |     네트워크 상에서 패킷의 이동을 다룸(패킷: 전송하는 데이터 최소 단위)     |
|     네트워크 인터페이스 계층     | LAN 드라이버, LAN 장비 |               네트워크에 접속하는 하드웨어적인 면               |

## 통신의 흐름 예시

1. 애플리케이션 계층의 `Socket Library`를 통해 OS에 메시지 전달
2. OS의 TCP 계층에서 메시지(데이터)에 TCP 정보 생성
3. OS의 IP 계층에서 TCP 정보에 IP 정보 생성
4. 네트워크 인터페이스 LAN 카드를 통해 나갈 때 `Ethernet Frame`을 통해 전송

## 전송된 데이터 형태

```
- *IP 패킷 헤더
----- 버전 / 헤더 길이 / 서비스 유형 / 총 데이터그램 길이(바이트)
----- 패킷 ID / 플래그 / 플래그 오프셋
----- 유지 시간(TTL) / 상위 계층 프로토콜 / 헤더 체크섬
----- 발신지 IP 주소
----- 목적지 IP 주소
--------- *TCP 세그먼트 헤더
------------- 발신지 포트 / 목적지 포트
------------- TCP 순서 번호
------------- 편승(piggback) 확인 응답
------------- 헤더 길이 / 예약어 / URG / ACK / PSH / RST / SYN / FIN / 윈도우 크기
------------- TCP 체크섬
------------- 긴급 포인터
----------------- *TCP 데이터 조각
-------------------- HTTP 메시지
```

## 소켓 인터페이스를 사용한 HTTP 네트워크 흐름

|     클라이언트     |       서버       |
|:-------------:|:--------------:|
|               |   새로운 소켓 생성    |
|               |  80포트로 소켓을 묶음  |
|               |   소켓 커넥션 허가    |
|               |    커넥션을 기다림    |
| IP 주소와 포트를 얻음 |                |
|   새로운 소켓 생성   |                |
| 서버의 IP 포트로 연결 |                |
|               | 애플리케이션 커넥션 통지  |
|               |   요청을 읽기 시작    |
|     연결 성공     |                |
|  HTTP 요청을 보냄  |                |
|  HTTP 응답 대기   |                |
|               | HTTP 요청 메시지 처리 |
|               | HTTP 응답 메시지 전송 |
|  HTTP 응답 처리   |                |
|    커넥션 닫음     |     커넥션 닫음     |

###### 출처

- https://www.inflearn.com/course/http-웹-네트워크
- [HTTP 완벽 가이드](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=294437345)