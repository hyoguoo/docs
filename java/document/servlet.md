# Servlet

> 자바를 이용한 웹 프로그래밍을 위한 기술

클라이언트가 어떠한 요청을 하면 그에 대한 처리를 수행하는 역할을 한다.

## 특징

- 클라이언트의 요청에 대해 동적으로 작동하는 웹 애플리케이션 컴포넌트
- Java Thread 기반으로 동작
- MVC 패턴에서 Controller 역할을 수행
- HTTP 프로토콜 서비스를 지원하는 `javax.servlet.http.HttpServlet` 클래스를 상속 받음

## 동작 방식

1. 사용자가 HTTP Request를 Servlet Container에 전달
2. 요청을 받은 Servlet Container에서 `HttpServletRequest`와 `HttpServletResponse` 객체를 생성
3. web.xml 기반으로 사용자가 요청한 서블릿 탐색
4. 해당 서블릿에서 `service()` 메소드 호출
5. `service()` 메소드에서 HTTP Method에 따라 `doGet()`, `doPost()` 등의 메소드 호출
6. `doGet()`, `doPost()` 등의 메서드에서 동적 페이지 생성
7. 생성한 동적 페이지를 `HttpServletResponse` 객체에 응답을 전송
8. 전송이 완료되면 `HttpServletRequest`, `HttpServletResponse` 객체 소멸

## Servlet Container

> 서블릿을 실행시키고 관리하는 역할을 하는 컴포넌트

서블릿 컨테이너는 클라리언트의 요청을 받아주고 응답할 수 있게, 웹서버와 소켓으로 통신하게 되며, 그 예로 톰캣이 있다.

### Servlet Container의 역할

1. 웹서버와 통신 지원

    - 서블릿과 웹서버가 통신하기 위해 필요한 기능을 제공
    - 통신을 하기 위해 `listen`, `accept` 등을 사용해야하지만 서블릿 컨테이너에서 이러한 기능을 API로 제공하여 생략 가능

2. 서블릿 생명주기 관리

    - 서블릿의 생성, 초기화, 호출, 소멸 등의 생명주기를 관리
    - 서블릿 클래스를 인스턴스화하여 초기화 메서드를 호출하고, 그 외에 요청이 들어오면 적절한 서블릿 메서드를 호출
    - 서블릿이 더 이상 필요하지 않을 때 Garbage Collection을 수행

3. 멀티 쓰레드 지원 및 관리

    - 서블릿은 쓰레드로 동작하기 때문에 요청이 올 때마다 쓰레드 가져와 처리
    - 멀티 쓰레드 부분을 관리하고, 쓰레드 풀을 사용하여 쓰레드를 재사용
    - 개발자가 쓰레드를 직접 관리할 필요가 없이 싱글 쓰레드 프로그래밍 하듯이 편하게 개발 가능

4. 선언적인 보안 관리

    - 서블릿에 대한 보안을 관리를 해주어 보안 관련 코드를 작성하지 않아도 됨

### Servlet Life Cycle

1. 서블릿 클래스 로딩 및 인스턴스 생성

    - 클라이언트 요청이 들어왔을 때 컨테이너에서 해당 서블릿이 메모리에 로딩되어 있는지 확인
    - 없는 경우, `init()` 메서드를 호출(`init()` 메서드는 서블릿이 최초로 요청되었을 때 한 번만 호출)

2. 서블릿 서비스 메서드 호출

    - `service()` 메서드는 클라이언트의 요청 방식에 따라 `doGet()`, `doPost()` 등의 메서드를 호출

3. 서블릿 소멸

    - 컨테이너가 서블릿에 종료를 명령하면 `destroy()` 메서드를 호출

###### 참고자료

- [스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술](https://www.inflearn.com/course/스프링-mvc-1)