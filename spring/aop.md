# AOP(Aspect-Oriented Programming)

> 관점 지향 프로그래밍

애플리케이션 로직은 크게 핵심 기능과 부가 기능으로 나눌 수 있다.  
보통 부가 기능은 여러 클래스에 걸쳐 사용되는 경우가 많아 중복 코드가 발생하여 유지보수가 어려워지며, 핵심 기능의 코드를 흐리게 만든다.  
떄문이 이를 분리하려는 시도를 하기 시작했고, 부가적인 기능을 분리하여 설계하여 개발 하는 방법을 AOP라고 한다.

** AOP는 OOP를 보완하는 수단으로 OOP를 대체하는 것이 아니다.

## 적용 방식

AOP를 사용할 때 부가 기능 조작을 추가하는 방법(시점)은 크게 세가지가 있다.

- 컴파일 시점
    - 컴파일러에서 `.class`를 만드는 시점에서 부가 기능 로직을 추가하는 방법으로 위빙(weaving)이라고 한다.
    - 특별한 컴파일러도 필요하고 복잡하기 때문에 잘 사용하지 않는다.
- 클래스 로딩 시점
    - `.class` 파일을 JVM 내부의 클래스 로더에 보관하는 시점에 부가 기능 로직을 추가하는 방법으로 로드 타임 위빙(Load Time Weaving)이라고 한다.
    - 모니터링 툴들이 이 방식을 사용한다.
    - 클래스 로더 조작기를 지정하여 사용하는데, 운영하기 어려워 잘 사용하지 않는다.
- 런타임 시점
    - 자바의 메인 메서드가 실행된 다음에 부가 기능 로직을 추가하는 방법으로 프록시 객체를 통해 구현할 수 있다.
    - 프록시를 사용하기 때문에 메서드 실행 지점에만 AOP를 적용할 수 있다.(제한된 기능)
    - 하지만 스프링을 사용하면 복잡한 과정을 거치지 않고도 AOP를 적용할 수 있다.

런타임 시점에서 하면 메서드 실행 시점에만 적용할 수 있지만, 스프링을 사용하면 복잡한 과정을 거치지 않고도 AOP를 적용할 수 있다.  
게다가 스프링 AOP로 실무에서의 대부분 문제를 해결할 수 있기 때문에 스프링 AOP를 사용하는 것이 좋다.

## 용어 정리

- 조인 포인트(Join point)
    - 어드바이스가 적용될 수 있는 위치, 메소드 실행, 생성자 호출, 필드 값 접근, static 메서드 접근 같은 프로그램 실행 중 지점
    - 조인 포인트는 추상적인 개념으로, AOP를 적용할 수 있는 모든 지점
    - 스프링 AOP는 프록시 방식을 사용하므로 조인 포인트는 항상 메소드 실행 지점으로 제한
- 포인트컷(Pointcut)
    - 조인 포인트 중에서 어드바이스가 적용될 위치를 선별하는 기능
    - 주로 AspectJ 표현식을 사용해서 지정
    - 프록시를 사용하는 스프링 AOP는 메서드 실행 지점만 포인트컷으로 선별 가능
- 타겟(Target)
    - 어드바이스를 받는 객체
- 어드바이스(Advice)
    - 부가 기능
    - 특정 조인 포인트에서 Aspect에 의해 취해지는 조치
    - Around(주변), Before(전), After(후)와 같은 다양한 종류의 어드바이스가 있음
- 애스펙트(Aspect)
    - 어드바이스 + 포인트컷을 모듈화 한 것
    - @Aspect 를 생각하면 됨
    - 여러 어드바이스와 포인트 컷이 함께 존재
- 어드바이저(Advisor)
    - 하나의 어드바이스와 하나의 포인트 컷으로 구성
    - 스프링 AOP에서만 사용되는 특별한 용어
- 위빙(Weaving)
    - 포인트컷으로 결정한 타켓의 조인 포인트에 어드바이스를 적용하는 것
    - 위빙을 통해 핵심 기능 코드에 영향을 주지 않고 부가 기능을 추가 할 수 있음
- AOP 프록시
    - AOP 기능을 구현하기 위해 만든 프록시 객체
    - 스프링에서 JDK 동적 프록시 또는 CGLIB 프록시를 사용

## 스프링에서의 AOP

스프링에서는 AOP를 위해 프록시 객체를 생성하여 사용하며, [프록시](proxy.md) 문서에서 확인할 수 있다.

###### 참고자료

- [스프링 핵심 원리 - 고급편](https://www.inflearn.com/course/스프링-핵심-원리-고급편)